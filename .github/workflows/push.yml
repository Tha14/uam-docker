name: run-docker-compose-workflow
on: [push, workflow_dispatch]
jobs:
  single-instance-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build the stack
        run: cd uam && PBKEY=${{ secrets.PBKEY }} docker-compose up -d
      - name: Sleep until uam is running
        run: sleep 100s
        shell: bash
      - name: Test if uam mining port is open
        run: nc -z -w30 127.0.0.1 4156
      - name: Test if uam http statistics port is open
        run: nc -z -w30 127.0.0.1 17099
